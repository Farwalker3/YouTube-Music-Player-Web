<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Music Player</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="icon" href="Jacob_profile_picture_icon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">
</head>
<body>
    <div id="background"></div>
    <div class="container">
        <div class="row justify-content-center align-items-stretch">        
            <!-- Card 1: Music Player -->
            <div class="col-md-3 col-12 d-flex">
                <div class="card shadow-lg w-100 h-100" style="max-height: 890px;"> <!-- Added min-height -->
                    <div class="card-body text-center d-flex flex-column">
                        <h5 class="card-title fw-bold">üéµ YouTube Music Player</h5>
    
                        <div class="album-art-container">
                            <img id="albumArt" src="https://via.placeholder.com/300" alt="Album Art" class="img-fluid shadow">
                        </div>                        
    
                        <h4 id="nowPlaying" class="text-center mt-3">
                            <!-- <span class="status">Not Playing</span> <br> -->
                            <span class="song-title">Loading...</span> <br>
                            <span class="author-name text-muted"></span>
                        </h4>
                        
                        <div class="progress-container">
                            <div class="progress mt-2" id="progressBar">
                                <div id="progress" class="progress-bar" style="width: 0%;"></div>
                            </div>
                            <div class="time-display">
                                <span id="currentTime">0:00</span>
                                <span id="totalTime">0:00</span>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-center mt-3 gap-2">
                            <button id="prevBtn" class="btn btn-primary rounded-circle px-3"><i class='bx bx-skip-previous' ></i></button>
                            <button id="playPauseBtn" class="btn btn-success rounded-circle px-4"><i class='bx bx-play'></i></button>
                            <button id="nextBtn" class="btn btn-primary rounded-circle px-3"><i class='bx bx-skip-next' ></i></button>
                        </div>
    
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <div class="auto-play-toggle d-flex align-items-center gap-2">
                                <label class="switch">
                                    <input type="checkbox" id="autoPlayToggle" checked>
                                    <span class="slider"></span>
                                </label>
                                <span>Auto-Play</span>
                            </div>       
                        
                            <div class="d-flex align-items-center gap-2">
                                <button id="repeatBtn" class="btn btn-secondary rounded-circle"><i class='bx bx-repeat' ></i></button>
                                <span class="fw-bold">Repeat</span>
                            </div>                            
                        </div>
    
                        <div class="d-flex align-items-center gap-3 mt-4">
                            <box-icon name='volume-low'></box-icon>
                            <input type="range" id="volumeControl" class="form-range" min="0" max="100" value="100">
                            <box-icon name='volume-full'></box-icon>
                        </div>
    
                        <p id="errorMessage" class="text-danger mt-2">‚ö† This song is unavailable.</p>
                    </div>
                </div>
            </div>
    
            <!-- Card 2: Song Selector -->
            <div class="col-md-8 col-12 mt-4 mt-md-0">
                <div class="card shadow-lg">
                    <div class="card-body">
                        <h5 class="card-title text-center fw-bold">üé∂ Select Song</h5>

                        <!-- Song List Headers -->
                        <div class="d-flex justify-content-between px-3 fw-bold border-bottom pb-2">
                            <span>Song Name</span>
                            <span>Author Name</span>
                        </div>

                        <ul id="songList" class="list-group overflow-auto" style="max-height: 620px;">

                            <!-- Japanese Song -->
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="wX_y95OrHLQ" data-img="https://i.ytimg.com/vi/wX_y95OrHLQ/hqdefault.jpg">
                                <span class="song">Starlight Traveler</span>
                                <span class="author text-muted">D-D-Dice ¬∑ aaaa</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="qvk4Rl7r2GY" data-img="https://i.ytimg.com/vi/qvk4Rl7r2GY/hqdefault.jpg">
                                <span class="song">ÁôæËä±Áπö‰π±</span>
                                <span class="author text-muted">ÂπæÁî∞„Çä„Çâ (Lilas Ikuta)</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="q4CbHfW3Ji8" data-img="https://i.ytimg.com/vi/q4CbHfW3Ji8/hqdefault.jpg">
                                <span class="song">„Çπ„Éë„Éº„ÇØ„É´ - Sparkle</span>
                                <span class="author text-muted">ÂπæÁî∞„Çä„Çâ (Lilas Ikuta)</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="kerzepq4imY" data-img="https://i.ytimg.com/vi/kerzepq4imY/hqdefault.jpg">
                                <span class="song">„ÇÇ„Åó„ÇÇÊòéÊó•„Åå</span>
                                <span class="author text-muted">Warabe („Çè„Çâ„Åπ)</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="U4pM3yB9KtU" data-img="https://i.ytimg.com/vi/U4pM3yB9KtU/hqdefault.jpg">
                                <span class="song">MUGEN</span>
                                <span class="author text-muted">MY FIRST STORY</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="jg-uSq64Ru8" data-img="https://i.ytimg.com/vi/jg-uSq64Ru8/hqdefault.jpg">
                                <span class="song">Omokage (produced by Vaundy)</span>
                                <span class="author text-muted">milet ¬∑ Aimer ¬∑ Lilas Ikuta</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="OxiyIW2y1bg" data-img="https://i.ytimg.com/vi/OxiyIW2y1bg/hqdefault.jpg">
                                <span class="song">Her Blue Sky</span>
                                <span class="author text-muted">Á©∫„ÅÆÈùí„Åï„ÇíÁü•„Çã‰∫∫„Çà</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="zP2uM7_EV1I" data-img="https://i.ytimg.com/vi/zP2uM7_EV1I/hqdefault.jpg">
                                <span class="song">„Ç´„É°„É¨„Ç™„É≥ (Chameleon)</span>
                                <span class="author text-muted">King Gnu</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="Auq8qj7uuF0" data-img="https://i.ytimg.com/vi/Auq8qj7uuF0/hqdefault.jpg">
                                <span class="song">Shiori</span>
                                <span class="author text-muted">SEKAI NO OWARI</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="12IZ8oyF6X4" data-img="https://i.ytimg.com/vi/12IZ8oyF6X4/hqdefault.jpg">
                                <span class="song">Shuhasu</span>
                                <span class="author text-muted">SEKAI NO OWARI</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="jTTuA0msOyg" data-img="https://i.ytimg.com/vi/jTTuA0msOyg/hqdefault.jpg">
                                <span class="song">Present</span>
                                <span class="author text-muted">SEKAI NO OWARI</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="gZFGA41Slh0" data-img="https://i.ytimg.com/vi/gZFGA41Slh0/hqdefault.jpg">
                                <span class="song">Illumination</span>
                                <span class="author text-muted">SEKAI NO OWARI</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="QlyW9kYHTDo" data-img="https://i.ytimg.com/vi/QlyW9kYHTDo/hqdefault.jpg">
                                <span class="song">Time Machine</span>
                                <span class="author text-muted">SEKAI NO OWARI</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="zOkIe3RcTCs" data-img="https://i.ytimg.com/vi/zOkIe3RcTCs/hqdefault.jpg">
                                <span class="song">LADY</span>
                                <span class="author text-muted">Á±≥Ê¥•ÁéÑÂ∏´ Kenshi Yonezu</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="Ci_zad39Uhw" data-img="https://i.ytimg.com/vi/Ci_zad39Uhw/hqdefault.jpg">
                                <span class="song">Á≤õËÅñ!! „É≠„É™Á•û„É¨„ÇØ„Ç§„Ç®„É†‚òÜ</span>
                                <span class="author text-muted">„Åó„Åê„Çå„ÅÜ„ÅÑ</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="eSW2LVbPThw" data-img="https://i.ytimg.com/vi/eSW2LVbPThw/hqdefault.jpg">
                                <span class="song">Rabbit Hole feat. Hatsune Miku</span>
                                <span class="author text-muted">DECO*27</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="uKxyLmbOc0Q" data-img="https://i.ytimg.com/vi/uKxyLmbOc0Q/hqdefault.jpg">
                                <span class="song">Renai Circulation„ÄåÊÅãÊÑõ„Çµ„Éº„Ç≠„É•„É¨„Éº„Ç∑„Éß„É≥„Äç</span>
                                <span class="author text-muted">Ôºä„Å™„Åø„Çä„Çì (*Namirin)</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="RWFW1OSlMkM" data-img="https://i.ytimg.com/vi/RWFW1OSlMkM/hqdefault.jpg">
                                <span class="song">seisyun complex</span>
                                <span class="author text-muted">kessoku band</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="YjrSkBjDVEw" data-img="https://i.ytimg.com/vi/YjrSkBjDVEw/hqdefault.jpg">
                                <span class="song">Fukashigi no KARTE</span>
                                <span class="author text-muted">Mai Sakurajima(CV:Asami Seto) ¬∑ Tomoe Koga(CV:Nao Toyama) ¬∑ Rio Futaba(CV:Atsumi Tanezaki) ¬∑ Nodoka Toyohama(CV:Maaya Uchida) ¬∑ Kaede Azusagawa(CV:Yurika Kubo) ¬∑ Shoko Makinohara(CV:Inori Minase)</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="IRsobBUcvCs" data-img="https://i.ytimg.com/vi/IRsobBUcvCs/hqdefault.jpg">
                                <span class="song">DROPS (feat. Such)</span>
                                <span class="author text-muted">Zekk ¬∑ poplavor ¬∑ Such</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="XkNai2JPIK8" data-img="https://i.ytimg.com/vi/XkNai2JPIK8/hqdefault.jpg">
                                <span class="song">Â∞éÁÅ´</span>
                                <span class="author text-muted">Tsukuyomi / YurryCanon</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="G96Qa5QoEfI" data-img="https://i.ytimg.com/vi/G96Qa5QoEfI/hqdefault.jpg">
                                <span class="song">ÁôæËä±„ÅÆÁ¥ÑÊùü (feat. Â§ïÂá™Â§ú)</span>
                                <span class="author text-muted">ÈßíÊú®ÂÑ™ / relier (Yu Komaki ¬∑ Yoru Younagi)</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="eF_wT8KwXlI" data-img="https://i.ytimg.com/vi/eF_wT8KwXlI/hqdefault.jpg">
                                <span class="song">Psyched Fevereiro</span>
                                <span class="author text-muted">t+pazolite</span>
                            </li>

                            <!-- Chinese Song -->
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="N-RZKm29Qz8" data-img="https://i.ytimg.com/vi/N-RZKm29Qz8/hqdefault.jpg">
                                <span class="song">Êµ™‰∫∫ÁêµÁê∂</span>
                                <span class="author text-muted">ËÉ°66</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="YPdRwoIZgVs" data-img="https://i.ytimg.com/vi/YPdRwoIZgVs/hqdefault.jpg">
                                <span class="song">Êó•ËêΩÂ§ßÈÅì</span>
                                <span class="author text-muted">Ê¢ÅÂçö</span>
                            </li>

                            <!-- English Song -->
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="ekr2nIex040" data-img="https://i.ytimg.com/vi/ekr2nIex040/hqdefault.jpg">
                                <span class="song">APT.</span>
                                <span class="author text-muted">ROSEÃÅ & Bruno Mars</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="hJqYc62NCKo" data-img="https://i.ytimg.com/vi/hJqYc62NCKo/hqdefault.jpg">
                                <span class="song">We'll Meet Again</span>
                                <span class="author text-muted">TheFatRat & Laura Brehm</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center" data-video="dpT-TeRYFvY" data-img="https://i.ytimg.com/vi/dpT-TeRYFvY/hqdefault.jpg">
                                <span class="song">All For Love</span>
                                <span class="author text-muted">Tungevaag ¬∑ Raaban ¬∑ Richard Smitt</span>
                            </li>
                        </ul>                        
                    </div>
                </div>
            </div>
        </div>
    
        <div class="d-flex justify-content-center align-items-start flex-wrap" style="margin-top: 20px; gap: 20px; padding-bottom: 20px;">
            <!-- GitHub Profile Card -->
            <div class="card" style="width: 18rem;">
                <div class="card-body text-center">
                    <img src="https://github.com/Jacob7179.png" alt="GitHub Profile" class="rounded-circle img-fluid" style="width: 100px; height: 100px; object-fit: cover;">
                    <h5 class="card-title mt-2">Jacob7179</h5>
                    <p class="card-text">Check out my GitHub profile for more projects.</p>
                    <a href="https://github.com/Jacob7179" target="_blank" class="btn btn-dark">Visit Profile</a>
                </div>
            </div>
        
            <!-- YouTube Music Player Repository Card -->
            <div class="card" style="width: 18rem;">
                <div class="card-body text-center">
                    <h5 class="card-title">YouTube Music Player</h5>
                    <p class="card-text">Click the link below to visit the repository.</p>
                    <a href="https://github.com/Jacob7179/YouTube-Music-Player-Web" target="_blank" class="btn btn-primary">Visit GitHub</a>
                </div>
            </div>

            <div class="card shadow-lg">
                <div class="card-body text-center">
                    <h5 class="card-title fw-bold">üé• Video Player</h5>
                    <button id="togglePlayerBtn" class="btn btn-primary">Show Player</button>
                    <div id="playerContainer" class="mt-3" style="display: none;">
                        <div id="player"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let player;
        let playing = false;
        let songUnavailable = false;
        let progressInterval;
        let isDragging = false;
        let errorTimeout;
        let selectedVideoId = "wX_y95OrHLQ";

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                videoId: selectedVideoId,
                playerVars: {
                    autoplay: 0,
                    controls: 0,
                    modestbranding: 1,
                    showinfo: 0,
                    rel: 0
                },
                events: {
                    'onReady': () => {
                        player.setVolume(100);
                    },
                    'onStateChange': handlePlayerStateChange, // ‚úÖ Detect video state changes
                    'onError': handleVideoError
                }
            });
        }
        
        function handleVideoError(event) {
            let errorMsg = document.getElementById("errorMessage");
            errorMsg.style.display = "block"; // Show error message
            playing = false;
            songUnavailable = true;
        
            if (player && player.pauseVideo) {
                player.pauseVideo();
            }
        
            playPauseBtn.innerHTML = "<i class='bx bx-play' style='color: white; font-size: 24px;'></i>";
            document.getElementById("albumArt").classList.add("rotate-paused");
        
            // ‚úÖ Allow skipping only if Auto-Play is enabled
            clearTimeout(errorTimeout);
            errorTimeout = setTimeout(() => {
                errorMsg.style.display = "none"; // Hide error message
        
                if (document.getElementById("autoPlayToggle").checked) { 
                    playNextSong(); // ‚úÖ Only play next song if Auto-Play is ON
                }
            }, 3000);
        }        
        
        function loadNewVideo(videoId, albumArtUrl, selectedSong = null) {
            updateBackgroundImage(albumArtUrl);
            let albumArt = document.getElementById("albumArt");
        
            // ‚úÖ Fade-out effect before changing the image
            albumArt.style.transition = "opacity 0.5s ease-in-out";
            albumArt.style.opacity = "0";
        
            // ‚úÖ Change the image with a fade-in effect
            setTimeout(() => {
                albumArt.src = albumArtUrl;
                albumArt.style.opacity = "1";
            }, 500);
        
            if (selectedSong) {
                let songName = selectedSong.querySelector(".song").innerText;
                let authorName = selectedSong.querySelector(".author").innerText;
                document.querySelector("#nowPlaying .song-title").innerText = songName;
                document.querySelector("#nowPlaying .author-name").innerText = authorName;
            }
        
            clearTimeout(errorTimeout);
            document.getElementById("errorMessage").style.display = "none";
            songUnavailable = false;
        
            if (typeof player === "undefined" || !player.loadVideoById) {
                document.getElementById("playerContainer").innerHTML = `<div id="player"></div>`;
                onYouTubeIframeAPIReady();
                setTimeout(() => {
                    player.loadVideoById(videoId);
                    player.playVideo();
                }, 1000);
            } else {
                player.loadVideoById(videoId);
                player.playVideo();
            }
        
            // ‚úÖ Reset Progress Bar and Timer when selecting a new song
            document.getElementById("progress").style.width = "0%";
            document.getElementById("currentTime").innerText = "0:00";
            document.getElementById("totalTime").innerText = "0:00";
        
            playing = true;
            document.getElementById("playPauseBtn").innerHTML = "<i class='bx bx-pause' style='color: white; font-size: 24px;'></i>";
        
            // ‚úÖ Start tracking progress for the new song
            updateProgressBar();
        }        
        
        function playNextSong() {
            let songItems = document.querySelectorAll("#songList li");
            let currentSong = document.querySelector("#songList li.selected");
        
            let currentIndex = Array.from(songItems).indexOf(currentSong);
            let nextIndex = (currentIndex + 1) % songItems.length;
        
            let nextSong = songItems[nextIndex];
            nextSong.classList.add("selected");
            currentSong.classList.remove("selected");
        
            let nextVideoId = nextSong.getAttribute("data-video");
            let nextAlbumArtUrl = nextSong.getAttribute("data-img");
        
            // ‚úÖ Ensure "Now Playing" updates correctly
            loadNewVideo(nextVideoId, nextAlbumArtUrl, nextSong);
        
            nextSong.scrollIntoView({ behavior: "smooth", block: "nearest" });
        }        
        
        // Handle song list selection
        document.querySelectorAll("#songList li").forEach(item => {
            item.addEventListener("click", function () {
                // ‚úÖ Remove highlight from previous selection
                document.querySelectorAll("#songList li").forEach(li => li.classList.remove("selected"));
        
                // ‚úÖ Highlight selected song
                this.classList.add("selected");
        
                let videoId = this.getAttribute("data-video");
                let albumArtUrl = this.getAttribute("data-img");
        
                loadNewVideo(videoId, albumArtUrl, this);
        
                // ‚úÖ Ensure the progress bar updates for the new song
                updateProgressBar();
            });
        });        
        
        document.querySelectorAll("#songList li").forEach(item => {
            item.addEventListener("click", function () {
                // Remove highlight from previous selection
                document.querySelectorAll("#songList li").forEach(li => li.classList.remove("selected"));
        
                // Highlight selected song
                this.classList.add("selected");
        
                // Update album art
                let albumArt = document.getElementById("albumArt");
                albumArt.src = this.getAttribute("data-img");
        
                // Play new song
                let videoId = this.getAttribute("data-video");
                if (player) {
                    player.loadVideoById(videoId);
                    playing = true;
                    document.getElementById("playPauseBtn").innerHTML = "<i class='bx bx-pause' style='color: white; font-size: 24px;'></i>";
                }
            });
        });

        function updateBackgroundImage(imageUrl) {
            let background = document.getElementById("background");
            background.style.backgroundImage = `url(${imageUrl})`;
        }
        
        // Apply background change when clicking a song
        document.querySelectorAll("#songList li").forEach((item, index) => {
            // Add numbering
            let numberSpan = document.createElement("span");
            numberSpan.classList.add("song-number");
            numberSpan.textContent = (index + 1) + ".\u00A0"; 
            item.prepend(numberSpan);
        
            // Handle song selection
            item.addEventListener("click", function () {
                let videoId = this.getAttribute("data-video");
                let albumArtUrl = this.getAttribute("data-img");
        
                loadNewVideo(videoId, albumArtUrl, this);
            });
        });
        
        // Set default selected song on page load
        document.addEventListener("DOMContentLoaded", function () {
            let firstSong = document.querySelector("#songList li");
        
            if (firstSong) {
                document.querySelectorAll("#songList li").forEach(li => li.classList.remove("selected"));
                firstSong.classList.add("selected");
        
                let firstImage = firstSong.getAttribute("data-img");
                let firstSongName = firstSong.querySelector(".song").innerText;
                let firstAuthorName = firstSong.querySelector(".author").innerText;
        
                if (firstImage) {
                    document.getElementById("albumArt").src = firstImage;
                    document.getElementById("background").style.backgroundImage = `url(${firstImage})`;
                }
        
                // ‚úÖ Correctly set the first song as "Now Playing"
                //document.querySelector("#nowPlaying .status").innerText = "Now Playing:";
                document.querySelector("#nowPlaying .song-title").innerText = firstSongName;
                document.querySelector("#nowPlaying .author-name").innerText = firstAuthorName;
            }
        });        
        
        // Set default selected song
        document.querySelector("#songList li").classList.add("selected");        

        window.onload = function() {
            let firstSong = document.querySelector("#songList li");
            if (firstSong) {
                firstSong.classList.add("selected");
                let albumArtUrl = firstSong.getAttribute("data-img");
                document.getElementById("albumArt").src = albumArtUrl;
            }
        };        

        document.getElementById("playPauseBtn").addEventListener("click", function () {
            if (songUnavailable) return; // Prevent play if song is unavailable
        
            let albumArt = document.getElementById("albumArt");
        
            if (player) {
                if (playing) {
                    player.pauseVideo();
                    this.innerHTML = "<i class='bx bx-play' style='color: white; font-size: 24px;'></i>"; // ‚úÖ Play button
                    clearInterval(progressInterval);
                    albumArt.classList.add("rotate-paused");
                } else {
                    player.playVideo();
                    this.innerHTML = "<i class='bx bx-pause' style='color: white; font-size: 24px;'></i>"; // ‚úÖ Pause button
                    updateProgressBar();
                    albumArt.classList.remove("rotate-paused");
                    albumArt.classList.add("rotate");
        
                    // ‚úÖ If bx-revision is showing, reset it to Play/Pause
                    if (this.innerHTML.includes("bx-revision")) {
                        this.innerHTML = "<i class='bx bx-pause' style='color: white; font-size: 24px;'></i>";
                    }
                }
                playing = !playing;
            }
        });        

        document.getElementById("prevBtn").addEventListener("click", playPreviousSong);
        document.getElementById("nextBtn").addEventListener("click", playNextSong);

        function playPreviousSong() {
            let songItems = document.querySelectorAll("#songList li");
            let currentSong = document.querySelector("#songList li.selected");

            let currentIndex = Array.from(songItems).indexOf(currentSong);
            let prevIndex = (currentIndex - 1 + songItems.length) % songItems.length;

            let prevSong = songItems[prevIndex];
            prevSong.classList.add("selected");
            currentSong.classList.remove("selected");

            let prevVideoId = prevSong.getAttribute("data-video");
            let prevAlbumArtUrl = prevSong.getAttribute("data-img");

            loadNewVideo(prevVideoId, prevAlbumArtUrl, prevSong);
            prevSong.scrollIntoView({ behavior: "smooth", block: "nearest" });
        }

        function playNextSong() {
            let songItems = document.querySelectorAll("#songList li");
            let currentSong = document.querySelector("#songList li.selected");

            let currentIndex = Array.from(songItems).indexOf(currentSong);
            let nextIndex = (currentIndex + 1) % songItems.length;

            let nextSong = songItems[nextIndex];
            nextSong.classList.add("selected");
            currentSong.classList.remove("selected");

            let nextVideoId = nextSong.getAttribute("data-video");
            let nextAlbumArtUrl = nextSong.getAttribute("data-img");

            loadNewVideo(nextVideoId, nextAlbumArtUrl, nextSong);
            nextSong.scrollIntoView({ behavior: "smooth", block: "nearest" });
        }

        function updateProgressBar() {
            clearInterval(progressInterval);
            progressInterval = setInterval(() => {
                if (player && player.getCurrentTime && !isDragging) {
                    let currentTime = player.getCurrentTime();
                    let duration = player.getDuration();
        
                    if (duration > 0) {
                        let progressPercent = (currentTime / duration) * 100;
                        document.getElementById("progress").style.width = progressPercent + "%";
        
                        // ‚úÖ Update time display correctly
                        document.getElementById("currentTime").innerText = formatTime(currentTime);
                        document.getElementById("totalTime").innerText = formatTime(duration);
                    }
        
                    // ‚úÖ If video ends, handle accordingly
                    if (player.getPlayerState() === 0) { // 0 = ENDED
                        clearInterval(progressInterval);
                        let playPauseBtn = document.getElementById("playPauseBtn");
                        let autoPlayToggle = document.getElementById("autoPlayToggle").checked;
        
                        if (!autoPlayToggle) {
                            playPauseBtn.innerHTML = "<i class='bx bx-revision' style='color: white; font-size: 24px;'></i>";
                        } else {
                            playPauseBtn.innerHTML = "<i class='bx bx-play' style='color: white; font-size: 24px;'></i>";
                        }
                        playing = false;
                    }
                }
            }, 1000);
        }        
        
        function formatTime(seconds) {
            let mins = Math.floor(seconds / 60);
            let secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? "0" : ""}${secs}`;
        }        

        const progressBar = document.getElementById("progressBar");
        const progress = document.getElementById("progress");

        progressBar.addEventListener("mousedown", function(event) {
            if (songUnavailable) return; // Don't seek if song is unavailable
            isDragging = true;
            seek(event);
        });

        document.addEventListener("mousemove", function(event) {
            if (isDragging) {
                seek(event);
            }
        });

        document.addEventListener("mouseup", function(event) {
            if (isDragging) {
                isDragging = false;
                if (!playing) {
                    player.pauseVideo(); // Don't auto-play if the song was paused
                }
            }
        });

        function seek(event) {
            let barWidth = progressBar.offsetWidth;
            let clickPosition = event.clientX - progressBar.getBoundingClientRect().left;
            let seekTime = (clickPosition / barWidth) * player.getDuration();
        
            if (player) {
                player.seekTo(seekTime, true);
        
                // ‚úÖ Keep the paused state if it was paused before seeking
                if (!playing) {
                    player.pauseVideo();
                }
        
                let progressPercent = (seekTime / player.getDuration()) * 100;
                progress.style.width = progressPercent + "%";
            }
        }        

        let tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        let firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        document.getElementById("volumeControl").addEventListener("input", function () {
            if (player) {
                player.setVolume(this.value);
            }
        });

        let repeatSong = false; // Track repeat mode

        document.getElementById("repeatBtn").addEventListener("click", function () {
            repeatSong = !repeatSong;
            this.classList.toggle("active", repeatSong); // Toggle active class
        });
        
        function handlePlayerStateChange(event) {
            let albumArt = document.getElementById("albumArt");
            let playPauseBtn = document.getElementById("playPauseBtn");
            let autoPlay = document.getElementById("autoPlayToggle").checked;
        
            if (event.data === 0) { // ‚úÖ 0 means video ended
                playing = false;
                albumArt.classList.add("rotate-paused");
        
                if (repeatSong) {
                    player.seekTo(0); // ‚úÖ Restart the current song
                    player.playVideo(); // ‚úÖ Always play again when Repeat is ON
                } else if (autoPlay) {
                    playNextSong(); // ‚úÖ Play next song if Auto-Play is ON
                } else {
                    // ‚úÖ Show bx-revision when the song ends and Auto-Play is OFF
                    playPauseBtn.innerHTML = "<i class='bx bx-revision' style='color: white; font-size: 24px;'></i>";
                }
            } else if (event.data === 2) { // ‚úÖ 2 means PAUSED
                playPauseBtn.innerHTML = "<i class='bx bx-play' style='color: white; font-size: 24px;'></i>";
                playing = false;
                albumArt.classList.add("rotate-paused");
            } else if (event.data === 1) { // ‚úÖ 1 means PLAYING
                playPauseBtn.innerHTML = "<i class='bx bx-pause' style='color: white; font-size: 24px;'></i>";
                playing = true;
                albumArt.classList.remove("rotate-paused");
                albumArt.classList.add("rotate");
            }
        }

        document.getElementById("togglePlayerBtn").addEventListener("click", function () {
            let playerContainer = document.getElementById("playerContainer");
        
            if (playerContainer.style.display === "none") {
                playerContainer.style.display = "block";
                this.innerText = "Hide Player";
            } else {
                playerContainer.style.display = "none";
                this.innerText = "Show Player";
            }
        });        
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
</body>
</html>
