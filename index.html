<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Music Player</title>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
        }
        #albumArt {
            width: 300px;
            height: 300px;
            object-fit: cover;
            border-radius: 50%; /* Makes it circular */
            margin-bottom: 10px;
        }        
        #playerContainer {
            position: absolute;
            width: 0;
            height: 0;
            overflow: hidden;
        }
        .controls {
            margin-top: 10px;
        }
        #progressBar {
            width: 300px;
            height: 5px;
            background: #ddd;
            margin: 10px auto;
            position: relative;
            cursor: pointer;
        }
        #progress {
            height: 100%;
            width: 0%;
            background: #007bff;
            position: absolute;
            transition: width 0.1s linear;
        }
        #errorMessage {
            color: red;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        .rotate {
            animation: rotate 5s linear infinite;
        }
        
        /* Pause rotation but keep current position */
        .rotate-paused {
            animation-play-state: paused;
        }
    </style>
</head>
<body>
    <h2>üéµ YouTube Music Player</h2>

    <img id="albumArt" src="https://via.placeholder.com/300" alt="Album Art">

    <div id="progressBar">
        <div id="progress"></div>
    </div>

    <div class="controls">
        <button id="playPauseBtn">‚ñ∂ Play</button>
    </div>

    <select id="songSelector">
        <option value="wX_y95OrHLQ" data-img="https://i.ytimg.com/vi/wX_y95OrHLQ/hqdefault.jpg">Starlight Traveler ¬∑ D-D-Dice ¬∑ aaaa</option>
        <option value="hJqYc62NCKo" data-img="https://i.ytimg.com/vi/hJqYc62NCKo/hqdefault.jpg">TheFatRat & Laura Brehm - We'll Meet Again</option>
        <option value="dpT-TeRYFvY" data-img="https://i.ytimg.com/vi/dpT-TeRYFvY/hqdefault.jpg">All For Love ¬∑ Tungevaag ¬∑ Raaban ¬∑ Richard Smitt</option>
        <option value="kerzepq4imY" data-img="https://i.ytimg.com/vi/kerzepq4imY/hqdefault.jpg">Warabe („Çè„Çâ„Åπ) - „ÇÇ„Åó„ÇÇÊòéÊó•„Åå</option>
        <option value="jg-uSq64Ru8" data-img="https://i.ytimg.com/vi/jg-uSq64Ru8/hqdefault.jpg">Omokage (produced by Vaundy) ¬∑ milet ¬∑ Aimer ¬∑ Lilas Ikuta</option>
        <option value="ekr2nIex040" data-img="https://i.ytimg.com/vi/ekr2nIex040/hqdefault.jpg">ROSEÃÅ & Bruno Mars - APT.</option>
    </select>

    <div id="playerContainer">
        <div id="player"></div>
    </div>

    <p id="errorMessage">‚ö† This song is unavailable.</p>

    <script>
        let player;
        let playing = false;
        let songUnavailable = false;
        let progressInterval;
        let isDragging = false;
        let errorTimeout;
        let selectedVideoId = "wX_y95OrHLQ";

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                videoId: selectedVideoId,
                playerVars: {
                    autoplay: 0,
                    controls: 0,
                    modestbranding: 1,
                    showinfo: 0,
                    rel: 0
                },
                events: {
                    'onReady': () => {
                        player.setVolume(100);
                    },
                    'onStateChange': handlePlayerStateChange, // ‚úÖ Detect video state changes
                    'onError': handleVideoError
                }
            });
        }
        
        function handlePlayerStateChange(event) {
            let albumArt = document.getElementById("albumArt");
        
            if (event.data === 0) { // ‚úÖ 0 means video ended
                document.getElementById("playPauseBtn").innerText = "‚ñ∂ Play";
                playing = false;
        
                // ‚úÖ Pause rotation when audio ends
                albumArt.classList.add("rotate-paused");
        
                // ‚úÖ Auto-play the next song
                playNextSong();
            }
        }                

        function handleVideoError(event) {
            let errorMsg = document.getElementById("errorMessage");
            errorMsg.style.display = "block"; // Show error message
            playing = false;
            songUnavailable = true;
        
            // Pause player & stop rotation
            player.pauseVideo();
            document.getElementById("playPauseBtn").innerText = "‚ñ∂ Play";
            document.getElementById("albumArt").classList.add("rotate-paused");
        
            // ‚úÖ Set timeout and store its reference
            errorTimeout = setTimeout(() => {
                errorMsg.style.display = "none"; // Hide error message
                playNextSong();
            }, 3000);
        }      
        
        function playNextSong() {
            let songSelector = document.getElementById("songSelector");
            let currentIndex = songSelector.selectedIndex;
            let nextIndex = (currentIndex + 1) % songSelector.options.length; // Loop back to first song if at end
            songSelector.selectedIndex = nextIndex; // Select the next song
        
            let nextVideoId = songSelector.options[nextIndex].value;
            let nextAlbumArtUrl = songSelector.options[nextIndex].getAttribute("data-img");
        
            // ‚úÖ Update album art
            document.getElementById("albumArt").src = nextAlbumArtUrl;
            document.getElementById("errorMessage").style.display = "none"; // Hide error message
            songUnavailable = false; // Reset error state
        
            if (player) {
                player.loadVideoById(nextVideoId);
                playing = true;
                document.getElementById("playPauseBtn").innerText = "‚è∏ Pause";
        
                clearInterval(progressInterval);
                updateProgressBar();
        
                // ‚úÖ Ensure album rotates when a new song is selected
                document.getElementById("albumArt").classList.remove("rotate-paused");
                document.getElementById("albumArt").classList.add("rotate");
            }
        }        

        document.getElementById("songSelector").addEventListener("change", function () {
            const videoId = this.value;
            const albumArtUrl = this.options[this.selectedIndex].getAttribute("data-img");
            let albumArt = document.getElementById("albumArt");
        
            document.getElementById("albumArt").src = albumArtUrl;
            document.getElementById("errorMessage").style.display = "none"; // Hide error message
            
            // ‚úÖ Cancel the timeout if a new song is selected
            clearTimeout(errorTimeout);
        
            // ‚úÖ Reset unavailable detection
            songUnavailable = false;
        
            if (player) {
                player.loadVideoById(videoId);
                playing = true;
                document.getElementById("playPauseBtn").innerText = "‚è∏ Pause";
        
                clearInterval(progressInterval);
                updateProgressBar();
        
                // ‚úÖ Ensure album rotates when a new song is selected
                albumArt.classList.remove("rotate-paused");
                albumArt.classList.add("rotate");
            }
        });        

        window.onload = function() {
            const defaultOption = document.getElementById("songSelector").options[0];
            document.getElementById("albumArt").src = defaultOption.getAttribute("data-img");
        };

        document.getElementById("playPauseBtn").addEventListener("click", function () {
            if (songUnavailable) return; // Prevent play if song is unavailable
        
            let albumArt = document.getElementById("albumArt");
        
            if (player) {
                if (playing) {
                    player.pauseVideo();
                    this.innerText = "‚ñ∂ Play";
                    clearInterval(progressInterval);
        
                    // Pause rotation but keep current position
                    albumArt.classList.add("rotate-paused");
        
                } else {
                    player.playVideo();
                    this.innerText = "‚è∏ Pause";
                    updateProgressBar();
        
                    // Resume rotation if not paused manually
                    albumArt.classList.remove("rotate-paused");
                    albumArt.classList.add("rotate");
                }
                playing = !playing;
            }
        });

        function updateProgressBar() {
            clearInterval(progressInterval);
            progressInterval = setInterval(() => {
                if (player && player.getCurrentTime && !isDragging) {
                    let currentTime = player.getCurrentTime();
                    let duration = player.getDuration();
                    if (duration > 0) {
                        let progressPercent = (currentTime / duration) * 100;
                        document.getElementById("progress").style.width = progressPercent + "%";
                    }

                    if (player.getPlayerState() === 0) {
                        clearInterval(progressInterval);
                        document.getElementById("playPauseBtn").innerText = "‚ñ∂ Play";
                        playing = false;
                    }
                }
            }, 1000);
        }

        const progressBar = document.getElementById("progressBar");
        const progress = document.getElementById("progress");

        progressBar.addEventListener("mousedown", function(event) {
            if (songUnavailable) return; // Don't seek if song is unavailable
            isDragging = true;
            seek(event);
        });

        document.addEventListener("mousemove", function(event) {
            if (isDragging) {
                seek(event);
            }
        });

        document.addEventListener("mouseup", function(event) {
            if (isDragging) {
                isDragging = false;
                if (!playing) {
                    player.pauseVideo(); // Don't auto-play if the song was paused
                }
            }
        });

        function seek(event) {
            let barWidth = progressBar.offsetWidth;
            let clickPosition = event.clientX - progressBar.getBoundingClientRect().left;
            let seekTime = (clickPosition / barWidth) * player.getDuration();
        
            if (player) {
                player.seekTo(seekTime, true);
        
                // ‚úÖ Keep the paused state if it was paused before seeking
                if (!playing) {
                    player.pauseVideo();
                }
        
                let progressPercent = (seekTime / player.getDuration()) * 100;
                progress.style.width = progressPercent + "%";
            }
        }        

        let tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        let firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    </script>
</body>
</html>
